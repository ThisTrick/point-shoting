/**
 * Theme System
 * 
 * Comprehensive theme switching system featuring:
 * - Light/Dark/System theme modes
 * - Smooth theme transitions with CSS animations
 * - Theme persistence in localStorage
 * - System preference detection and auto-switching
 * - Custom color palette overrides for branding
 * - High contrast mode support for accessibility
 * - Animation-aware theme switching (respects prefers-reduced-motion)
 */

/* ==========================================
   THEME TRANSITION ANIMATIONS
   ========================================== */

html {
  /* Theme transition for smooth switching */
  transition: background-color var(--duration-300) var(--ease-out),
              color var(--duration-300) var(--ease-out);
}

body,
*:not(input):not(textarea):not(select) {
  /* Apply theme transitions to all elements except form inputs */
  transition: background-color var(--duration-200) var(--ease-out),
              border-color var(--duration-200) var(--ease-out),
              color var(--duration-200) var(--ease-out),
              box-shadow var(--duration-200) var(--ease-out);
}

/* Disable transitions during theme initialization to prevent flash */
.theme-transitioning * {
  transition: none !important;
}

/* ==========================================
   SYSTEM THEME DETECTION
   ========================================== */

/* Auto theme follows system preference when data-theme="system" */
@media (prefers-color-scheme: dark) {
  [data-theme="system"] {
    /* Apply dark theme variables */
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --bg-tertiary: #334155;
    --bg-accent: #475569;
    --bg-muted: #64748b;

    --text-primary: #f8fafc;
    --text-secondary: #e2e8f0;
    --text-tertiary: #cbd5e1;
    --text-muted: #94a3b8;
    --text-inverse: #0f172a;

    --border-primary: #334155;
    --border-secondary: #475569;
    --border-accent: #64748b;
    --border-focus: #60a5fa;
    --border-error: #f87171;
    --border-success: #4ade80;
    --border-warning: #fbbf24;

    --color-primary: #60a5fa;
    --color-primary-hover: #3b82f6;
    --color-primary-active: #2563eb;
    --color-primary-light: #1e3a8a;
    
    --color-secondary: #818cf8;
    --color-secondary-hover: #6366f1;
    --color-secondary-active: #5048e5;
    --color-secondary-light: #312e81;

    --color-success: #4ade80;
    --color-success-hover: #22c55e;
    --color-success-light: #14532d;
    
    --color-warning: #fbbf24;
    --color-warning-hover: #f59e0b;
    --color-warning-light: #92400e;
    
    --color-error: #f87171;
    --color-error-hover: #ef4444;
    --color-error-light: #991b1b;
    
    --color-info: #22d3ee;
    --color-info-hover: #06b6d4;
    --color-info-light: #164e63;

    --color-hover: #334155;
    --color-active: #475569;
    --color-focus: #60a5fa;
    --color-disabled: #1e293b;
    --color-selected: #1e3a8a;

    /* Adjust shadows for dark theme */
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
    --shadow-base: 0 1px 3px 0 rgb(0 0 0 / 0.4), 0 1px 2px -1px rgb(0 0 0 / 0.4);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.4);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.4);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.4), 0 8px 10px -6px rgb(0 0 0 / 0.4);
    --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.6);
  }
}

@media (prefers-color-scheme: light) {
  [data-theme="system"] {
    /* Light theme is already default, but explicitly set for clarity */
    --bg-primary: #ffffff;
    --bg-secondary: #f8fafc;
    --bg-tertiary: #f1f5f9;
    --bg-accent: #e2e8f0;
    --bg-muted: #64748b;

    --text-primary: #0f172a;
    --text-secondary: #475569;
    --text-tertiary: #64748b;
    --text-muted: #94a3b8;
    --text-inverse: #ffffff;

    --border-primary: #e2e8f0;
    --border-secondary: #cbd5e1;
    --border-accent: #94a3b8;
    --border-focus: #3b82f6;
    --border-error: #ef4444;
    --border-success: #22c55e;
    --border-warning: #f59e0b;

    --color-primary: #3b82f6;
    --color-primary-hover: #2563eb;
    --color-primary-active: #1d4ed8;
    --color-primary-light: #dbeafe;
    
    --color-secondary: #6366f1;
    --color-secondary-hover: #5048e5;
    --color-secondary-active: #4338ca;
    --color-secondary-light: #e0e7ff;

    --color-success: #22c55e;
    --color-success-hover: #16a34a;
    --color-success-light: #dcfce7;
    
    --color-warning: #f59e0b;
    --color-warning-hover: #d97706;
    --color-warning-light: #fef3c7;
    
    --color-error: #ef4444;
    --color-error-hover: #dc2626;
    --color-error-light: #fecaca;
    
    --color-info: #06b6d4;
    --color-info-hover: #0891b2;
    --color-info-light: #cffafe;

    --color-hover: #f1f5f9;
    --color-active: #e2e8f0;
    --color-focus: #3b82f6;
    --color-disabled: #f1f5f9;
    --color-selected: #dbeafe;
  }
}

/* ==========================================
   HIGH CONTRAST THEME VARIANTS
   ========================================== */

/* High contrast light theme */
[data-theme="light"][data-contrast="high"],
[data-theme="system"][data-contrast="high"] {
  --bg-primary: #ffffff;
  --bg-secondary: #f0f0f0;
  --bg-tertiary: #e0e0e0;
  
  --text-primary: #000000;
  --text-secondary: #000000;
  --text-tertiary: #333333;
  
  --border-primary: #000000;
  --border-secondary: #333333;
  --border-focus: #0066cc;
  
  --color-primary: #0066cc;
  --color-primary-hover: #004499;
  
  --color-error: #cc0000;
  --color-error-hover: #990000;
  
  --color-success: #006600;
  --color-success-hover: #004400;
  
  --color-warning: #cc6600;
  --color-warning-hover: #994400;
}

/* High contrast dark theme */
[data-theme="dark"][data-contrast="high"] {
  --bg-primary: #000000;
  --bg-secondary: #1a1a1a;
  --bg-tertiary: #333333;
  
  --text-primary: #ffffff;
  --text-secondary: #ffffff;
  --text-tertiary: #cccccc;
  
  --border-primary: #ffffff;
  --border-secondary: #cccccc;
  --border-focus: #66ccff;
  
  --color-primary: #66ccff;
  --color-primary-hover: #99ddff;
  
  --color-error: #ff6666;
  --color-error-hover: #ff9999;
  
  --color-success: #66ff66;
  --color-success-hover: #99ff99;
  
  --color-warning: #ffcc66;
  --color-warning-hover: #ffdd99;
}

/* ==========================================
   BRAND COLOR OVERRIDES
   ========================================== */

/* Animation-focused brand colors */
[data-brand="animation"] {
  --color-primary: #8b5cf6;        /* Purple for creative/artistic feel */
  --color-primary-hover: #7c3aed;
  --color-primary-active: #6d28d9;
  --color-primary-light: #ede9fe;
  
  --color-secondary: #06b6d4;      /* Cyan for motion/fluidity */
  --color-secondary-hover: #0891b2;
  --color-secondary-active: #0e7490;
  --color-secondary-light: #cffafe;
}

[data-theme="dark"][data-brand="animation"] {
  --color-primary: #a78bfa;
  --color-primary-hover: #8b5cf6;
  --color-primary-light: #4c1d95;
  
  --color-secondary: #22d3ee;
  --color-secondary-hover: #06b6d4;
  --color-secondary-light: #164e63;
}

/* Professional brand colors */
[data-brand="professional"] {
  --color-primary: #1f2937;        /* Dark gray for professional look */
  --color-primary-hover: #111827;
  --color-primary-active: #030712;
  --color-primary-light: #f9fafb;
  
  --color-secondary: #059669;      /* Green for success/completion */
  --color-secondary-hover: #047857;
  --color-secondary-active: #065f46;
  --color-secondary-light: #d1fae5;
}

[data-theme="dark"][data-brand="professional"] {
  --color-primary: #f9fafb;
  --color-primary-hover: #f3f4f6;
  --color-primary-light: #1f2937;
  
  --color-secondary: #10b981;
  --color-secondary-hover: #059669;
  --color-secondary-light: #064e3b;
}

/* ==========================================
   THEME SWITCHING UTILITIES
   ========================================== */

/* Theme selector component styles */
.theme-selector {
  position: relative;
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2);
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-lg);
  transition: all var(--duration-200) var(--ease-out);
}

.theme-selector:hover {
  background-color: var(--color-hover);
  border-color: var(--border-secondary);
}

.theme-option {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--duration-200) var(--ease-out);
  border: 2px solid transparent;
}

.theme-option:hover {
  background-color: var(--color-hover);
}

.theme-option.active {
  background-color: var(--color-primary);
  color: var(--text-inverse);
  border-color: var(--color-primary);
}

.theme-option:focus {
  outline: 2px solid var(--border-focus);
  outline-offset: 2px;
}

/* Theme transition overlay (prevents flash during switch) */
.theme-transition-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--bg-primary);
  opacity: 0;
  pointer-events: none;
  z-index: var(--z-modal);
  transition: opacity var(--duration-150) var(--ease-out);
}

.theme-transition-overlay.active {
  opacity: 0.8;
}

/* ==========================================
   THEME-AWARE COMPONENT ADJUSTMENTS
   ========================================== */

/* Adjust syntax highlighting for theme */
[data-theme="dark"] pre code {
  background-color: var(--bg-tertiary);
  color: #e2e8f0;
}

[data-theme="dark"] .hljs-keyword {
  color: #f472b6;
}

[data-theme="dark"] .hljs-string {
  color: #34d399;
}

[data-theme="dark"] .hljs-number {
  color: #60a5fa;
}

[data-theme="dark"] .hljs-comment {
  color: #9ca3af;
}

/* Theme-specific image filters for dark mode */
[data-theme="dark"] img.theme-invert {
  filter: invert(1) hue-rotate(180deg);
}

[data-theme="dark"] .icon-neutral {
  filter: invert(1);
}

/* Adjust glass/blur effects for themes */
.glass-effect {
  background-color: rgb(255 255 255 / 0.8);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

[data-theme="dark"] .glass-effect {
  background-color: rgb(15 23 42 / 0.8);
}

/* ==========================================
   THEME PERSISTENCE & SYSTEM INTEGRATION
   ========================================== */

/* Hide content until theme is loaded to prevent flash */
html:not([data-theme-loaded]) body {
  visibility: hidden;
}

/* Smooth theme loading animation */
html[data-theme-loaded] body {
  visibility: visible;
  animation: theme-fade-in var(--duration-300) var(--ease-out);
}

@keyframes theme-fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* ==========================================
   REDUCED MOTION SUPPORT
   ========================================== */

@media (prefers-reduced-motion: reduce) {
  html,
  body,
  *:not(input):not(textarea):not(select) {
    transition-duration: 0.01ms !important;
  }
  
  .theme-transition-overlay {
    transition-duration: 0.01ms !important;
  }
  
  @keyframes theme-fade-in {
    from, to {
      opacity: 1;
    }
  }
}

/* ==========================================
   THEME DEBUG UTILITIES (Development Only)
   ========================================== */

/* Show current theme in development */
body::before {
  content: attr(data-theme) " theme";
  position: fixed;
  top: 0;
  right: 0;
  background: var(--color-primary);
  color: var(--text-inverse);
  padding: var(--space-1) var(--space-2);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  z-index: var(--z-toast);
  border-bottom-left-radius: var(--radius-md);
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--duration-200) var(--ease-out);
}

/* Show theme debug info when data-debug="true" */
[data-debug="true"] body::before {
  opacity: 1;
}

[data-contrast="high"] body::after {
  content: "High Contrast";
  position: fixed;
  top: 24px;
  right: 0;
  background: var(--color-warning);
  color: var(--text-inverse);
  padding: var(--space-1) var(--space-2);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  z-index: var(--z-toast);
  border-bottom-left-radius: var(--radius-md);
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--duration-200) var(--ease-out);
}

[data-debug="true"][data-contrast="high"] body::after {
  opacity: 1;
}

/* ==========================================
   CUSTOM SCROLLBAR FOR THEMES
   ========================================== */

/* Light theme scrollbar */
[data-theme="light"]::-webkit-scrollbar-track,
[data-theme="system"]::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

[data-theme="light"]::-webkit-scrollbar-thumb,
[data-theme="system"]::-webkit-scrollbar-thumb {
  background: var(--border-accent);
}

[data-theme="light"]::-webkit-scrollbar-thumb:hover,
[data-theme="system"]::-webkit-scrollbar-thumb:hover {
  background: var(--text-tertiary);
}

/* Dark theme scrollbar */
[data-theme="dark"]::-webkit-scrollbar-track {
  background: var(--bg-tertiary);
}

[data-theme="dark"]::-webkit-scrollbar-thumb {
  background: var(--border-secondary);
}

[data-theme="dark"]::-webkit-scrollbar-thumb:hover {
  background: var(--text-secondary);
}

/* ==========================================
   PRINT THEME OVERRIDE
   ========================================== */

@media print {
  /* Force light theme for printing */
  * {
    --bg-primary: #ffffff !important;
    --bg-secondary: #f8fafc !important;
    --text-primary: #000000 !important;
    --text-secondary: #374151 !important;
    --border-primary: #d1d5db !important;
  }
  
  /* Hide theme selector in print */
  .theme-selector,
  .theme-option {
    display: none !important;
  }
}